<div class="settings-dialog">
  <div class="settings-header">
    <mat-icon>settings</mat-icon>
    <h2>Settings</h2>
  </div>

  <div class="settings-content">
    <!-- Remote Access Section (only shown on local Electron app, not remote browsers) -->
    @if (isElectron) {
    <div class="settings-section">
      <h3>
        <mat-icon>lan</mat-icon>
        Remote Access
      </h3>
      <p class="section-description">
        Serve the Castle UI over HTTP so you can access it from other devices on your network or Tailscale tailnet.
      </p>

      <div class="setting-row">
        <div class="setting-label">
          <span>Enable remote access</span>
        </div>
        <mat-slide-toggle
          [(ngModel)]="tailscaleEnabled"
          (change)="onToggle()"
          [disabled]="saving">
        </mat-slide-toggle>
      </div>

      @if (tailscaleEnabled) {
        <div class="setting-row port-row">
          <mat-form-field appearance="outline" class="port-field">
            <mat-label>Port</mat-label>
            <input matInput type="number" [(ngModel)]="tailscalePort" min="1024" max="65535">
          </mat-form-field>
          <button mat-stroked-button (click)="applyPort()" [disabled]="saving">
            Apply
          </button>
        </div>

        <div class="status-row">
          @if (tailscaleRunning) {
            <mat-icon class="status-icon running">check_circle</mat-icon>
            <span class="status-text running">
              Running on <code>http://localhost:{{ tailscalePort }}</code>
            </span>
          } @else {
            <mat-icon class="status-icon stopped">radio_button_unchecked</mat-icon>
            <span class="status-text stopped">Not running</span>
          }
        </div>

        @if (tailscaleError) {
          <div class="error-row">
            <mat-icon>error</mat-icon>
            <span>{{ tailscaleError }}</span>
          </div>
        }
      }
    </div>
    } @else {
    <div class="settings-section">
      <p class="section-description">Remote access settings are only available from the local app.</p>
    </div>
    }
  </div>

  <!-- Worktree / Git Settings Section -->
  <div class="settings-section">
    <h3>
      <mat-icon>account_tree</mat-icon>
      Git Worktrees
    </h3>
    <p class="section-description">
      Enable isolated git worktrees for parallel agent implementation tasks. Each task gets its own branch and working directory.
    </p>

    <div class="setting-row">
      <div class="setting-label">
        <span>Enable worktree isolation</span>
      </div>
      <mat-slide-toggle
        [(ngModel)]="worktreeEnabled"
        (change)="saveWorktreeSettings()"
        [disabled]="saving">
      </mat-slide-toggle>
    </div>

    @if (worktreeEnabled) {
      <div class="setting-row">
        <div class="setting-label">
          <span>Auto-install dependencies</span>
        </div>
        <mat-slide-toggle
          [(ngModel)]="worktreeAutoInstallDeps"
          (change)="saveWorktreeSettings()"
          [disabled]="saving">
        </mat-slide-toggle>
      </div>

      <div class="setting-row">
        <div class="setting-label">
          <span>Create PRs as draft</span>
        </div>
        <mat-slide-toggle
          [(ngModel)]="worktreeDraftPR"
          (change)="saveWorktreeSettings()"
          [disabled]="saving">
        </mat-slide-toggle>
      </div>

      <div class="setting-row">
        <mat-form-field appearance="outline" class="port-field">
          <mat-label>Max concurrent worktrees</mat-label>
          <input matInput type="number" [(ngModel)]="worktreeMaxConcurrent" min="1" max="10">
        </mat-form-field>
        <button mat-stroked-button (click)="saveWorktreeSettings()" [disabled]="saving">
          Apply
        </button>
      </div>

      <div class="setting-row">
        <mat-form-field appearance="outline" class="port-field">
          <mat-label>Default base branch</mat-label>
          <input matInput type="text" [(ngModel)]="worktreeDefaultBaseBranch" placeholder="main">
        </mat-form-field>
        <button mat-stroked-button (click)="saveWorktreeSettings()" [disabled]="saving">
          Apply
        </button>
      </div>
    }
  </div>

  <div class="settings-footer">
    <button mat-button (click)="close()">Close</button>
  </div>
</div>
