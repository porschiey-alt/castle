<div class="chat-wrapper">
  <!-- Task / lifecycle banner pinned to top -->
  @if (linkedTask(); as task) {
    <div class="task-banner">
      <span class="task-icon">ðŸ“‹</span>
      <a class="task-link" (click)="onTaskClick()">{{ task.title }}</a>
      @if (lifecycleStatus(); as status) {
        <span class="task-separator">Â·</span>
        <span class="lifecycle-spinner"></span>
        <span class="lifecycle-text">{{ status }}</span>
      }
    </div>
  } @else if (lifecycleStatus()) {
    <div class="task-banner">
      <span class="lifecycle-spinner"></span>
      <span class="lifecycle-text">{{ lifecycleStatus() }}</span>
    </div>
  }

  <!-- Todo banner pinned to top -->
  @if (todoItems().length > 0) {
    <app-todo-banner [items]="todoItems()" />
  }

  <!-- Message list -->
  <app-message-list 
    [messages]="messages()"
    [streamingMessage]="streamingMessage()"
    [latestThinking]="latestThinking()"
    [agentName]="agent().name"
    [agentIcon]="agent().icon"
  />

  <!-- Chat input -->
  <app-chat-input
    [agentName]="agent().name"
    [isLoading]="isLoading()"
    [disabled]="isInitializing() || !agent().session || (agent().session?.status !== 'ready' && agent().session?.status !== 'busy')"
    (messageSent)="onSendMessage($event)"
    (stopRequested)="onStopProcessing()"
  />
</div>
